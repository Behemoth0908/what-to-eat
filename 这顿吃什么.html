<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¿™é¡¿åƒä»€ä¹ˆ - æ‹¯æ•‘é€‰æ‹©å›°éš¾ç—‡</title>
    <style>
        :root {
            --bg-color: #fff5f5;
            --card-bg: #ffffff;
            --primary-color: #ff6b6b;
            --secondary-color: #feca57;
            --text-color: #2d3436;
            --sub-text: #666;
            --border-color: #eee;
            --btn-hover: #fff5f5;
        }

        /* æ·±å¤œæ¨¡å¼é…è‰² */
        body.dark-mode {
            --bg-color: #1a1a2e;
            --card-bg: #16213e;
            --primary-color: #e94560;
            --secondary-color: #0f3460;
            --text-color: #e9ecef;
            --sub-text: #95a5a6;
            --border-color: #444;
            --btn-hover: #1f4068;
        }

        body {
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            transition: all 0.5s ease;
        }

        #app {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 450px;
            text-align: center;
            transition: all 0.5s ease;
        }

        h1 { color: var(--primary-color); margin-bottom: 1rem; }

        .progress-bar {
            height: 6px;
            background: var(--border-color);
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        #progress {
            height: 100%;
            background: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }

        .question-box h2 { font-size: 1.2rem; margin-bottom: 1.5rem; min-height: 3em; line-height: 1.4; }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        button {
            padding: 16px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            background: var(--card-bg);
            color: var(--text-color);
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        button:hover {
            border-color: var(--primary-color);
            background: var(--btn-hover);
            transform: translateY(-2px);
        }

        #result-container { display: none; }
        .food-name {
            font-size: 2.2rem;
            color: var(--primary-color);
            margin: 1.5rem 0 0.5rem 0;
            display: block;
            font-weight: bold;
        }
        
        #food-desc {
            color: var(--sub-text);
            font-style: italic;
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        .restart-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            width: 100%;
        }

        .shake-hint {
            margin-top: 20px;
            font-size: 0.85rem;
            color: var(--sub-text);
            opacity: 0.8;
        }

        /* æ‘‡ä¸€æ‘‡æ—¶çš„åŠ¨ç”»æç¤º */
        @keyframes shake-icon {
            0% { transform: rotate(0); }
            25% { transform: rotate(10deg); }
            50% { transform: rotate(-10deg); }
            75% { transform: rotate(10deg); }
            100% { transform: rotate(0); }
        }
        .shake-active { animation: shake-icon 0.5s infinite; }
    </style>
</head>
<body>

<div id="app">
    <div id="game-zone">
        <h1>è¿™é¡¿åƒä»€ä¹ˆ</h1>
        <div class="progress-bar"><div id="progress"></div></div>
        
        <div class="question-box">
            <h2 id="q-text">æ­£åœ¨ä¾¦æµ‹ä½ çš„èƒƒéƒ¨æ±‚æ•‘ä¿¡å·...</h2>
            <div class="options-container" id="options">
                <button onclick="startGame()">å¼€å§‹çµé­‚æŠ‰æ‹©</button>
            </div>
        </div>
        <p class="shake-hint" id="shake-text">ğŸ“± æ‰‹æœºç«¯å¯ç›´æ¥æ‘‡ä¸€æ‘‡å¬å¤©ç”±å‘½</p>
    </div>

    <div id="result-container">
        <h1>æœ€ç»ˆå†³è®®</h1>
        <p>ç»è¿‡å¤§æ•°æ®ï¼ˆå’Œç›´è§‰ï¼‰åˆ†æï¼š</p>
        <span class="food-name" id="food-result"></span>
        <p id="food-desc"></p>
        <button class="restart-btn" onclick="location.reload()">å†æµ‹ä¸€æ¬¡</button>
    </div>
</div>

<script>
    // 54ç§é£Ÿç‰©åº“
    const foods = [
        { name: "å…°å·æ‹‰é¢", tags: ["noodle", "budget", "fast", "hot", "lunch"], desc: "å¿«å‡†ç‹ ï¼Œæ˜¯å¯¹é¢é£Ÿæœ€èµ·ç çš„å°Šé‡ã€‚" },
        { name: "éº»è¾£çƒ«", tags: ["spicy", "budget", "hot", "solo", "night"], desc: "ä¸€ä¸ªäººçš„ç«é”…ç‹‚æ¬¢ã€‚" },
        { name: "å‡è„‚æ²™æ‹‰", tags: ["healthy", "mild", "cold", "light", "tea"], desc: "è‰è™½ç„¶ä¸å¥½åƒï¼Œä½†æ²¡ä»€ä¹ˆç½ªæ¶æ„Ÿå‘€ã€‚" },
        { name: "å››å·ç«é”…", tags: ["spicy", "party", "hot", "slow", "heavy", "night"], desc: "å¤§é”…å¯æ¶®ä¸‡ç‰©ã€‚" },
        { name: "ç¾å¼æ±‰å ¡", tags: ["carb", "fast", "heavy", "other", "lunch"], desc: "çƒ­é‡å³æ˜¯æ­£ä¹‰ï¼" },
        { name: "èºè›³ç²‰", tags: ["spicy", "solo", "heavy", "budget", "night"], desc: "é—»ç€è‡­åƒç€é¦™ã€‚åˆ«åœ¨å¯†é—­ç©ºé—´å—¦ã€‚" },
        { name: "å¯¿å¸æ‹¼ç›˜", tags: ["cold", "fancy", "mild", "popular", "tea"], desc: "æ€ä¹ˆä¸æ˜¯æ—¥å¼miniç›–æµ‡é¥­ã€‚" },
        { name: "æ½®æ±•ç‰›è‚‰ç«é”…", tags: ["healthy", "hot", "party", "mild", "slow"], desc: "æ¸…æ±¤é‡Œç¿»æ»šçš„ï¼Œæ˜¯é£Ÿæçš„åŸå‹ã€‚" },
        { name: "ä¾¿åˆ©åº—é¥­å›¢", tags: ["budget", "fast", "light", "solo", "breakfast"], desc: "æœ€å¿«çš„èƒ½é‡è¡¥ç»™ç«™ã€‚" },
        { name: "éŸ©å¼ç‚¸é¸¡", tags: ["carb", "heavy", "party", "other", "night"], desc: "é…¥è„†çš„å¤–çš®ä¸‹ï¼Œæ˜¯é¦‹è™«çš„é¿éš¾æ‰€ã€‚" },
        { name: "ç›–æµ‡é¥­", tags: ["rice", "mild", "popular", "budget", "lunch"], desc: "1+1ï¼2ã€‚" },
        { name: "é…¸èœé±¼", tags: ["middle-spicy", "rice", "couple", "popular", "lunch"], desc: "é…¸çˆ½å¼€èƒƒï¼Œé±¼ä½ åœ¨ä¸€èµ·ã€‚" },
        { name: "å¹¿å¼èŒ¶ç‚¹", tags: ["mild", "slow", "fancy", "light", "breakfast"], desc: "é¥®èŒ¶å…ˆå•¦ã€‚" },
        { name: "éº»è¾£é¦™é”…", tags: ["spicy", "heavy", "rice", "mid", "night"], desc: "ç±³é¥­æ€æ‰‹ï¼Œæ‡‚çš„éƒ½æ‡‚ã€‚" },
        { name: "æ„å¤§åˆ©é¢", tags: ["other", "mid", "mild", "couple", "lunch"], desc: "Eat it up~ Eat it eat it up~" },
        { name: "è·¯è¾¹ç‚­çƒ¤ä¸²", tags: ["party", "heavy", "hot", "mid", "night"], desc: "å–œæ¬¢ä¸€äº›æ²¡æœ‰è¾¹ç•Œæ„Ÿã€åŠå¤œä¸‰æ›´è‡ªåŠ¨åˆ·æ–°åœ¨å„å¤§å¤–å–å¹³å°çš„ç¾å‘³ä¸œè¥¿ã€‚" },
        { name: "ç“¦ç½æ±¤", tags: ["healthy", "hot", "mild", "budget", "lunch"], desc: "å‘µæŠ¤ä½ çš„è‚ èƒƒã€‚" },
        { name: "æµ·å—é¸¡é¥­", tags: ["rice", "mild", "mid", "healthy", "lunch"], desc: "å°±å¥½è¿™å£é¸¡æ²¹ã€‚" },
        { name: "ç…é¥¼æœå­", tags: ["budget", "fast", "carb", "other", "breakfast"], desc: "åŠ ä¸¤ä¸ªè›‹ï¼Œæ˜¯ç”Ÿæ´»çš„æœ€é«˜ç¤¼é‡ã€‚" },
        { name: "ç« é±¼å°ä¸¸å­", tags: ["light", "other", "budget", "cold", "tea"], desc: "æˆ‘å°±éšä¾¿åƒç‚¹ï¼ŒçœŸçš„ä¸é¥¿ã€‚" },
        { name: "å†·é¢/å‡‰çš®", tags: ["cold", "budget", "middle-spicy", "fast", "tea"], desc: "ç»™ç‡¥çƒ­çš„çµé­‚é™é™æ¸©ã€‚" },
        { name: "é‡åº†å°é¢", tags: ["noodle", "spicy", "fast", "budget", "breakfast"], desc: "éº»è¾£é²œé¦™ï¼Œä¸€ç¢—å…¥é­‚ã€‚" },
        { name: "éŸ©å¼éƒ¨é˜Ÿé”…", tags: ["hot", "middle-spicy", "couple", "carb", "night"], desc: "ç¢³æ°´ä¸èŠå£«çš„è·¨å›½è”å§»ã€‚" },
        { name: "é“æ¿ç‚’é¥­", tags: ["rice", "heavy", "fast", "budget", "night"], desc: "æµ¸é€äº†é”…æ°”çš„ä¸€ç¢—ç¢³æ°´ã€‚" },
        { name: "åŒ…å­/èŠ±å·/è€é¢é¦’å¤´", tags: ["budget", "fast", "hot", "solo", "breakfast"], desc: "å„¿æ—¶å¬äº†æ— æ•°å›çš„å†å–ã€‚" },
        { name: "çƒ§è…Šé¥­", tags: ["rice", "mid", "popular", "normal", "lunch"], desc: "å’¸ç”œé€‚å£ï¼Œæ²¹å…‰é”ƒäº®çš„è¯±æƒ‘ã€‚" },
        { name: "æ–°ç–†ç‚’ç±³ç²‰", tags: ["spicy", "heavy", "noodle", "fast", "night"], desc: "æ¬¸ï¼Œè¿™è¾£åº¦ä½ å—å¾—äº†å—ï¼Ÿ" },
        { name: "æ³¢å¥‡é¥­", tags: ["healthy", "cold", "rice", "light", "lunch"], desc: "å‡è£…åœ¨å¤å¨å¤·å†²æµªçš„æ¸…çˆ½æ„Ÿã€‚" },
        { name: "è¶Šå—æ²³ç²‰", tags: ["mild", "hot", "healthy", "noodle", "lunch"], desc: "ä¸€ç¢—æ¸…æ±¤ä¸‹ç‚¹ç²‰ï¼Œæ²»æ„ˆæ‰€æœ‰ä¸å¼€å¿ƒã€‚" },
        { name: "ç‚¸é…±é¢", tags: ["noodle", "mid", "heavy", "popular"], desc: "æ‹Œçš„æ˜¯é…±ï¼Œåƒçš„æ˜¯è®²ç©¶ã€‚" },
        { name: "æ­¦æ±‰çƒ­å¹²é¢", tags: ["noodle", "budget", "fast", "breakfast"], desc: "è¿‡æ—©æ¦œæ¦œé¦–ï¼ŒèŠéº»é…±ä¸ç¢±é¢çš„æè‡´ç¼ ç»µã€‚" },
        { name: "å¡”å¯", tags: ["other", "light", "cold", "tea"], desc: "å·èµ·å¼‚åŸŸé£æƒ…å¹¶å¤§å£åä¸‹ã€‚" },
        { name: "å°é¾™è™¾", tags: ["spicy", "party", "heavy", "night"], desc: "å‰¥å¼€çš„æ˜¯å£³ï¼Œä¸¢æ‰çš„æ˜¯å‹åŠ›ã€‚" },
        { name: "ä¸œåŒ—çƒ§çƒ¤", tags: ["party", "heavy", "hot", "night"], desc: "ç»™ç”Ÿæ´»æ•´ç‚¹çƒŸç«æ°”ï¼Œæ²¡å•¥è¿‡ä¸å»çš„ã€‚" },
        { name: "å’–å–±è›‹åŒ…é¥­", tags: ["rice", "mild", "mid", "popular"], desc: "è¢«æµ“éƒå’–å–±åŒ…è£¹çš„æ¸©æŸ”æ¢¦æƒ³ã€‚" },
        { name: "è‚‰å¤¹é¦", tags: ["other", "budget", "fast", "lunch"], desc: "è‚‰è¦è‚¥ç˜¦ç›¸é—´ï¼Œé¥¼è¦é…¥è„†æ‰æ¸£ã€‚" },
        { name: "åœŸè±†ç²‰", tags: ["noodle", "hot", "mid", "popular"], desc: "æ™¶è¹å¼¹ç‰™ï¼Œå¸æºœä¸€ä¸‹æ»‘è¿›èƒƒé‡Œã€‚" },
        { name: "è„†çš®äº”èŠ±è‚‰", tags: ["heavy", "other", "fast", "night"], desc: "å’”å“§ä¸€å£°ï¼Œçƒ¦æ¼å…¨æ¶ˆã€‚" },
        { name: "è¿‡æ¡¥ç±³çº¿", tags: ["noodle", "hot", "fancy", "slow"], desc: "æ±¤è¦æ»šçƒ«ï¼Œå¿ƒè¦æ·¡å®šã€‚" },
        { name: "é¸­è¡€ç²‰ä¸æ±¤", tags: ["mild", "hot", "light", "popular"], desc: "æ¸…é²œæ·¡é›…ï¼Œè¿™ä¸€å£å°±å¾ˆå—äº¬ã€‚" },
        { name: "ä¸²ä¸²é¦™", tags: ["spicy", "party", "hot", "night"], desc: "æ•°ç­¾å­çš„å¿«ä¹ï¼Œä½ ä¸æ‡‚ã€‚" },
        { name: "ç‰›æ’", tags: ["fancy", "heavy", "couple", "other"], desc: "æ‚¨è¦å‡ åˆ†ç†Ÿï¼Ÿ" },
        { name: "ç…é¥º/é”…è´´", tags: ["budget", "fast", "rice", "breakfast"], desc: "åº•è¦ç„¦é»„ï¼Œæ±è¦é²œç”œã€‚" },
        { name: "çª‘é¸¡", tags: ["heavy", "party", "hot", "popular"], desc: "åŸæ±åŸå‘³ï¼Œæ’•ç€åƒæ‰å¤Ÿçˆ½ã€‚" },
        { name: "è´æœ", tags: ["healthy", "light", "cold", "tea"], desc: "é¢åŒ…çš„ç™¾é¢åƒç›¸ã€‚" },
        { name: "éº»è¾£æ‹Œ", tags: ["spicy", "budget", "other", "night"], desc: "æ²¡æ±¤ä¹Ÿå¿«ä¹ï¼Œé…¸ç”œéº»è¾£å¤§ä¹±æ–—ã€‚" },
        { name: "æ¸©å·ç˜¦è‚‰ä¸¸", tags: ["light", "hot", "budget", "tea"], desc: "æ¸…æ±¤é‡Œçš„å¼¹æ€§é¢—ç²’æ„Ÿã€‚" },
        { name: "é¡ºå¾·æ‰“è¾¹ç‚‰", tags: ["mild", "healthy", "party", "fancy"], desc: "æ¸…æ°´å‡ºèŠ™è“‰ï¼Œé²œå‘³è‡ªå¤©æˆã€‚" },
        { name: "çŒªè„šé¥­", tags: ["rice", "heavy", "budget", "fast"], desc: "å¤é¦™å››æº¢ï¼Œä¸€æ‹½å°±è„±éª¨ã€‚" },
        { name: "å°ç¬¼åŒ…", tags: ["mild", "hot", "popular", "breakfast"], desc: "å…ˆå¼€çª—ï¼Œåå–æ±¤ã€‚" },
        { name: "æŠ«è¨", tags: ["other", "party", "carb", "popular"], desc: "èŠå£«æ‹‰ä¸çš„ç¬é—´ï¼Œçµé­‚ä¹Ÿå‡åäº†ã€‚" },
        { name: "å†¬é˜´åŠŸæ±¤", tags: ["spicy", "hot", "other", "lunch"], desc: "èˆŒå°–ä¸Šçš„ä¸œå—äºšæ´¾å¯¹ã€‚" },
        { name: "æ²™å¨ç›", tags: ["other", "fast", "mid", "lunch"], desc: "çŸ¥é“å¤§å®¶éƒ½æ˜¯å½“äº†åº—ä¸»æ¥çš„ã€‚" },
        { name: "æ‰¬å·ç‚’é¥­", tags: ["rice", "mild", "popular", "fast"], desc: "æ¯ä¸€ç²’ç±³éƒ½è¦è£¹ä¸Šè›‹æ¶²çš„è¾‰ç…Œã€‚" }
    ];

    const questions = [
        { q: "ç°åœ¨ä½ çš„è‚šå­é¥¿åˆ°äº†å“ªä¸ªçº§åˆ«ï¼Ÿ", options: [
            { t: "å¡«ä¸ªç¼å°±è¡Œ", tags: ["light"] },
            { t: "æ­£å¸¸å¹²é¥­", tags: ["normal"] },
            { t: "é¥¿åˆ°èƒ½åä¸‹ä¸€å¤´ç‰›", tags: ["heavy"] }
        ]},
        { q: "è§‚å¯Ÿä¸€ä¸‹ä½ ç°åœ¨çš„çŠ¶æ€ï¼š", options: [
            { t: "ç²¾ç¥ç´§ç»·ï¼Œå‹åŠ›å±±å¤§", tags: ["spicy", "heavy"] },
            { t: "å²æœˆé™å¥½ï¼Œå¿ƒå¹³æ°”å’Œ", tags: ["mild"] },
            { t: "æ²¡ç²¾æ‰“é‡‡ï¼Œæ€¥éœ€èƒ½é‡", tags: ["carb", "fast"] }
        ]},
        { q: "æ­¤æ—¶æ­¤åˆ»ï¼Œä½ çš„é£Ÿé“æ¸´æœ›æ€æ ·çš„æ´—ç¤¼ï¼Ÿ", options: [
            { t: "çƒ­è…¾è…¾çš„æŠšæ…°", tags: ["hot"] },
            { t: "å‡‰é£•é£•çš„åˆºæ¿€", tags: ["cold"] },
            { t: "å¸¸æ¸©å°±å¥½", tags: ["room"] }
        ]},
        { q: "æ‘¸æ‘¸å£è¢‹ï¼Œè¿™é¡¿é¥­çš„é¢„ç®—æ˜¯ï¼Ÿ", options: [
            { t: "ç©·é¬¼å¥—é¤", tags: ["budget"] },
            { t: "ä¸Šè¿™ä¹ˆä¹…çš„ç­/å­¦ï¼ŒçœŸæ˜¯è¾›è‹¦æˆ‘äº†ï¼ŒçŠ’åŠ³ä¸‹è‡ªå·±", tags: ["mid"] },
            { t: "è¿™ä¸€é¡¿å°†ä¼šå¾ˆç–¯ç‹‚", tags: ["fancy"] }
        ]},
        { q: "æƒ³åˆ°â€œé¢æ¡â€è¿™ä¸¤ä¸ªå­—ï¼Œä½ çš„ç¬¬ä¸€ååº”æ˜¯ï¼š", options: [
            { t: "æ—¢ç„¶æäº†å°±åƒå®ƒå§", tags: ["noodle"] },
            { t: "å“’å’©ï¼Œä»Šå¤©æƒ³åƒé¥­", tags: ["rice"] },
            { t: "è¿˜æœ‰åˆ«çš„é€‰é¡¹å—ï¼Ÿ", tags: ["other"] }
        ]},
        { q: "ä½ çš„è‚ èƒƒç°åœ¨çš„â€œæˆ˜æ–—åŠ›â€å¦‚ä½•ï¼Ÿ", options: [
            { t: "é’¢é“ä¹‹èº¯", tags: ["spicy"] },
            { t: "å¼±ä¸ç¦é£", tags: ["mild", "healthy"] },
            { t: "å·¦å³æ‘‡æ‘†", tags: ["middle-spicy"] }
        ]},
        { q: "è¿™é¡¿é¥­ä½ æ‰“ç®—èŠ±å¤šé•¿æ—¶é—´è§£å†³ï¼Ÿ", options: [
            { t: "5åˆ†é’Ÿæˆ˜æ–—ç»“æŸ", tags: ["fast"] },
            { t: "æ­£å¸¸çš„å°±é¤æ—¶å…‰", tags: ["normal-time"] },
            { t: "å¯ä»¥åƒåˆ°å¤©è’åœ°è€", tags: ["slow"] }
        ]},
        { q: "çœ‹ä¸€çœ¼çª—å¤–ï¼Œç°åœ¨çš„å¤©æ°”è®©ä½ è§‰å¾—ï¼š", options: [
            { t: "æ»¡å¤´å¤§æ±—æ‰çˆ½", tags: ["hot", "spicy"] },
            { t: "æ¸…æ·¡ä¸æ²¹è…»æœ€å¥½", tags: ["mild", "healthy"] },
            { t: "ç¢³æ°´ç‚¸å¼¹ä¸‡å²", tags: ["carb"] }
        ]},
        { q: "ä½ çš„ç¤¾äº¤çŠ¶æ€æ˜¯ï¼Ÿ", options: [
            { t: "å­¤ç‹¼ç‹¬é£Ÿ", tags: ["solo"] },
            { t: "ä¸¤äººçº¦ä¼š", tags: ["couple"] },
            { t: "èšä¼—åˆ†èµƒ", tags: ["party"] }
        ]},
        { q: "æœ€åï¼Œä½ æœ€æ€•è¿™é¡¿é¥­ï¼š", options: [
            { t: "å¤ªè´µ", tags: ["budget"] },
            { t: "ä¸å¥½åƒ", tags: ["popular"] },
            { t: "å‚¬äººä½“é‡ä¸Šå‡", tags: ["healthy"] }
        ]}
    ];

    let currentStep = 0;
    let userTags = {};
    let lastUpdate = 0;
    let lastX = 0, lastY = 0, lastZ = 0;

    // æ·±å¤œæ¨¡å¼è‡ªåŠ¨åˆ‡æ¢
    function applyNightMode() {
        const hour = new Date().getHours();
        if (hour >= 21 || hour < 5) {
            document.body.classList.add('dark-mode');
            document.getElementById('q-text').innerText = "å¤œæ·±äº†ï¼Œäººè¦åŒ–èº«é¥¿é¬¼äº†ã€‚";
        }
    }

    // æ—¶é—´æ ‡ç­¾è·å–
    function getTimeTag() {
        const hour = new Date().getHours();
        if (hour >= 5 && hour < 10) return "breakfast";
        if (hour >= 11 && hour < 14) return "lunch";
        if (hour >= 14 && hour < 17) return "tea";
        if (hour >= 20 || hour < 4) return "night";
        return "normal";
    }

    function startGame() {
        // è¯·æ±‚iOSéœ‡åŠ¨/æ„Ÿåº”æƒé™ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if (typeof DeviceMotionEvent !== 'undefined' && typeof DeviceMotionEvent.requestPermission === 'function') {
            DeviceMotionEvent.requestPermission();
        }
        showQuestion();
        initShake();
    }

    function showQuestion() {
        if (currentStep >= questions.length) {
            showResult();
            return;
        }

        const q = questions[currentStep];
        document.getElementById('q-text').innerText = q.q;
        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = '';

        q.options.forEach(opt => {
            const btn = document.createElement('button');
            btn.innerText = opt.t;
            btn.onclick = () => handleAnswer(opt.tags);
            optionsDiv.appendChild(btn);
        });

        document.getElementById('progress').style.width = (currentStep / questions.length * 100) + '%';
    }

    function handleAnswer(tags) {
        tags.forEach(t => { userTags[t] = (userTags[t] || 0) + 1; });
        currentStep++;
        showQuestion();
    }

    function showResult(isShake = false) {
        window.removeEventListener('devicemotion', deviceMotionHandler);
        document.getElementById('game-zone').style.display = 'none';
        document.getElementById('result-container').style.display = 'block';

        const timeTag = getTimeTag();
        let results = [];
        let maxScore = -1;

        foods.forEach(food => {
            let score = 0;
            // åŒ¹é…æ ‡ç­¾åˆ†
            food.tags.forEach(tag => { if (userTags[tag]) score += userTags[tag]; });
            // æ—¶é—´æƒé‡åˆ†
            if (food.tags.includes(timeTag)) score += 3;
            // éšæœºå¾®æ‰°ï¼Œé˜²æ­¢æ¯æ¬¡ç»“æœä¸€æ ·
            score += Math.random();

            if (score > maxScore) {
                maxScore = score;
                results = [food];
            } else if (score === maxScore) {
                results.push(food);
            }
        });

        const finalFood = results[Math.floor(Math.random() * results.length)];
        
        document.getElementById('food-result').innerText = (isShake ? "ğŸ² " : "") + finalFood.name;
        
        let extraMsg = "";
        if (document.body.classList.contains('dark-mode')) {
            const nightQuotes = ["é¥±é¥±çš„è‚šå­ï¼Œç»™æˆ‘æ·±å¤œæœ€å¥½çš„é™ªä¼´ã€‚", "å¡è·¯é‡Œåœ¨é»‘å¤œé‡Œä¸è®¡æ•°ã€‚", "åƒé¥±äº†æ‰å¥½ç¡å¤§è§‰ã€‚"];
            extraMsg = "\n\n" + nightQuotes[Math.floor(Math.random() * nightQuotes.length)];
        }
        
        document.getElementById('food-desc').innerText = "â€œ" + finalFood.desc + "â€" + extraMsg;
    }

    // æ‘‡ä¸€æ‘‡é€»è¾‘
    function initShake() {
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', deviceMotionHandler, false);
            document.getElementById('shake-text').classList.add('shake-active');
        }
    }

    function deviceMotionHandler(eventData) {
        const acceleration = eventData.accelerationIncludingGravity;
        const curTime = new Date().getTime();
        if ((curTime - lastUpdate) > 100) {
            const diffTime = curTime - lastUpdate;
            lastUpdate = curTime;
            const x = acceleration.x;
            const y = acceleration.y;
            const z = acceleration.z;
            const speed = Math.abs(x + y + z - lastX - lastY - lastZ) / diffTime * 10000;
            if (speed > 2500) { // æ‘‡æ™ƒé˜ˆå€¼
                showResult(true);
            }
            lastX = x; lastY = y; lastZ = z;
        }
    }

    window.onload = applyNightMode;
</script>

</body>
</html>